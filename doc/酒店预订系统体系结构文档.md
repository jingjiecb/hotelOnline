# 酒店预订系统体系结构文档
[TOC]

## 文档修改历史

| 修改人员 | 日期      | 修改原因                             | 版本号  |
| :------: | --------- | ------------------------------------ | ------- |
|  何知谦  | 2020.4.20 | 引言，产品概述，运行时进程，逻辑部署 | v0.1.1  |
|  王崇羽  | 2020.4.20 | 开发包图                             | v0.1.2  |
|  刘子龙  | 2020.4.20 | 逻辑视角                             | v0.1.3  |
|  刘一也  | 2020.4.20 | 开发包及其相互依赖                   | v0.1.4  |
|  王崇羽  | 2020.4.22 | 开发包图更新                         | v0.1.5  |
|  刘一也  | 2020.4.22 | 更新开发包及其相互依赖               | v0.1.6  |
|  刘一也  | 2020.4.23 | 添加模块职责                         | v0.1.7  |
|  王崇羽  | 2020.4.23 | 添加用户界面层分解                   | v0.1.8  |
|  何知谦  | 2020.4.23 | 添加业务逻辑层分解                   | v0.1.9  |
|  刘子龙  | 2020.4.23 | 添加业务逻辑层分解                   | v0.1.10 |
|  何知谦  | 2020.4.25 | 增加数据层分解                       | v0.1.11 |
|  刘一也  | 2020.4.25 | 增加数据层分解                       | v0.1.12 |
|  刘子龙  | 2020.4.25 | 增加数据层分解                       | v0.1.13 |
|  王崇羽  | 2020.4.25 | 增加数据层职责、信息视角             | v0.1.14 |
|  王崇羽  | 2020.6.12 | 维护表格内容                         | v0.1.15 |

## 1.引言

### 1.1编制目的

​		本报告详细完成对互联网酒店预订系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

​		本报告面向开发人员、测试人员以及最终用户而编写，是了解系统的导航。

### 1.2词汇表

| 词汇名称 | 词汇含义     | 备注 |
| :------: | ------------ | ---- |
|   HRS    | 酒店预订系统 | 无   |

### 1.3参考资料

​		大作业需求v3.pdf

​		软工二大作业迭代一功能需求简述.pdf

​	《软件工程与计算（卷二）软件开发技术基础》

## 2.产品概述

​		参考酒店预订系统用例文档和酒店预订系统需求规格说明中对产品的概述。

## 3.逻辑视图

酒店管理系统中，选择了分层体系结构风格，将系统分为3层（展示层、业务逻辑层、数据层）能够很好的示意整个高层抽象。展示层包含GUI页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案如下。

![参照体系结构风格的包图表达逻辑视角](https://teamwork-1301107071.cos.ap-shanghai.myqcloud.com/img/hotel/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%92.png)

图1  参照体系结构风格的包图表达逻辑视角

![软件体系结构逻辑设计方案](https://teamwork-1301107071.cos.ap-shanghai.myqcloud.com/img/hotel/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88.png)

图2 软件体系结构逻辑设计方案

## 4.组合视图

### 4.1开发包图

|      开发包       |                       依赖的其他开发包                       |
| :---------------: | :----------------------------------------------------------: |
|      mainui       |       adminui, couponui, hotelui, orderui, userui, vo        |
|      adminui      |                         adminapi, vo                         |
|     couponui      |                        couponapi, vo                         |
|      hotelui      |                         hotelapi, vo                         |
|      orderui      |                         orderapi, vo                         |
|      userui       | couponapi, hotelapi, hotelmanagerapi, orderapi, userapi, vo  |
|     adminapi      |                       admincontroller                        |
|     couponapi     |                       couponcontroller                       |
|     hotelapi      |                       hotelcontroller                        |
|  hotelmanagerapi  |                       hotelcontroller                        |
|     orderapi      |                       ordercontroller                        |
|      userapi      |                      accountcontroller                       |
|  admincontroller  |                      adminblservice, vo                      |
| couponcontroller  |                     couponblservice, vo                      |
|  hotelcontroller  |                      hotelblservice, vo                      |
|  ordercontroller  |                      orderblservice, vo                      |
| accountcontroller |                     accountblservice, vo                     |
|  adminblservice   |                              vo                              |
|  couponblservice  |                              vo                              |
|  hotelblservice   |                              vo                              |
|  orderblservice   |                              vo                              |
| accountblservice  |                              vo                              |
|      adminbl      | adminblservice, adminmapper, accountblservice,accountmapper,po |
|     couponbl      |              couponblservice, couponmapper, po               |
|      hotelbl      | orderblservice,hotelblservice,roomblservice,accountblservice,hotelmapper, roommapper, accountmapper, po |
|      orderbl      | hotelblservice,accountblservice,orderblservice, ordermapper, po,accountmapper,hotelmapper |
|     accountbl     |             accountblservice, accountmapper, po              |
|    adminmapper    |                              po                              |
|   couponmapper    |                              po                              |
|    hotelmapper    |                              po                              |
|    ordermapper    |                              po                              |
|   accountmapper   |                              po                              |
|     admindata     |                         adminmapper                          |
|    coupondata     |                         couponmapper                         |
|     hoteldata     |                         hotelmapper                          |
|     orderdata     |                         ordermapper                          |
|    accountdata    |                  adminmapper，accountmapper                  |
| creditrecorddata  |                  adminmapper，accountmapper                  |
|        po         |                                                              |
|        vo         |                                                              |

![img](https://web-1302222241.cos.ap-nanjing.myqcloud.com/%E9%85%92%E5%BA%97%E9%A2%84%E8%AE%A2%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE%20%284%29.png)

### 4.2运行时进程

​	在酒店预订系统中，会有多个浏览器对web服务器发起http请求获取信息。

![icon](https://wx1.sbimg.cn/2020/04/23/-4.png)

### 4.3物理部署

​	互联网酒店预订系统中，客户端一方只需安装现代浏览器（即支持HTML、XHTML、CSS、ECMAScript及W3C DOM标准的浏览器）。服务器构件部署在服务器端，如图所示。
- 示意图

![icon](https://wx1.sbimg.cn/2020/05/16/-3.png)

## 5.架构设计

- 描述功能分解和如何在不同的层中安排软件模块
  - 描述架构中的对象，包含类图
  - 描述组件供接口信息
    - 包括：语法、前置条件、后置条件
  - 描述组件需接口信息
    - 包括：服务名、服务

### 5.1模块职责

- 模块视图

酒店管理系统的模块视图如下图所示

![模块](http://cos.nju.world:9000/public-pictures/MdPics/%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE.jpg)

- 各层职责

|     层     |                     职责                     |
| :--------: | :------------------------------------------: |
|  启动模块  |     负责初始化网络通信机制，启动用户界面     |
|   展示层   |         提供基于浏览器显示的用户界面         |
|   网络层   |           使用Rest API与展示层通信           |
| 业务逻辑层 | 对于用户界面的输入进行相应并进行业务处理逻辑 |
|   数据层   |        负责数据持久化以及数据访问接口        |

- 每一层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层之间的调用如下表所示:


| 接口                                                         | 服务调用方 | 服务提供方 |
| :----------------------------------------------------------- | :--------- | :--------- |
| Rest API                                                     | 展示层     | 网络层     |
| AdminService CouponMathSrategy CouponService HotelService RoomService OrderService AccountService | 网络层     | 业务逻辑层 |
| Mybatis                                                      | 业务逻辑层 | 数据层     |

以Coupon为例说明层间调用，如下图所示：

![Order层间调用示例](https://web-1302222241.cos.ap-nanjing.myqcloud.com/%E8%B0%83%E7%94%A8%E5%9B%BE.png)

### 5.2用户界面层分解

​		根据需求，系统存在如下14个用户界面：登录界面、网站管理者界面、管理用户界面、酒店列表界面、酒店细节界面、酒店名片界面、订单填写界面、房间列表界面、酒店工作人员界面、增添优惠界面、增添酒店界面、增添房型界面、个人信息界面、订单界面。界面跳转图如图所示。

![](https://teamwork-1301107071.cos.ap-shanghai.myqcloud.com/img/hotel/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%E8%B7%B3%E8%BD%AC.png)

#### 5.2.1职责

- 类图

![](https://web-1302222241.cos.ap-nanjing.myqcloud.com/%E7%94%A8%E6%88%B7%E5%B1%95%E7%A4%BA%E5%B1%82%E8%81%8C%E8%B4%A3.png)

#### 5.2.2接口规范

**供接口**

| 模块            | 属性     | 内容                                                       |
| --------------- | :------- | ---------------------------------------------------------- |
| adminapi        | 语法     | getManagerListAPI()                                        |
|                 | 前置条件 | 以网站管理员的身份完成登录                                 |
|                 | 后置条件 | 显示所有酒店工作人员列表界面                               |
|                 | 语法     | getUserListAPI()                                           |
|                 | 前置条件 | 以网站管理员的身份完成登录                                 |
|                 | 后置条件 | 显示所有酒店一般用户列表界面                               |
|                 | 语法     | addManagerAPI(data)                                        |
|                 | 前置条件 | 以网站管理员的身份完成登录，并进入所有酒店工作人员列表界面 |
|                 | 后置条件 | 增添新酒店工作人员                                         |
|                 | 语法     | addUserAPI(data)                                           |
|                 | 前置条件 | 以网站管理员的身份完成登录，并进入所有酒店一般用户列表界面 |
|                 | 后置条件 | 增加新的一般用户                                           |
|                 | 语法     | addCreditAPI(id,credit)                                    |
|                 | 前置条件 | 以网站管理员的身份完成登录，并进入所有酒店一般用户列表界面 |
|                 | 后置条件 | 为选定一般用户增加信用值                                   |
|                 | 语法     | deleteUserAPI(userId)                                      |
|                 | 前置条件 | 以网站管理员的身份完成登录                                 |
|                 | 后置条件 | 删除选定用户                                               |
|                 | 语法     | updateManagerAPI(data)                                     |
|                 | 前置条件 | 以网站管理员的身份完成登录，并进入所有酒店工作人员列表界面 |
|                 | 后置条件 | 更新选定酒店工作人员信息                                   |
|                 | 语法     | updateUserAPI(data)                                        |
|                 | 前置条件 | 以网站管理员的身份完成登录，并进入所有酒店一般用户列表界面 |
|                 | 后置条件 | 更新选定一般客户信息                                       |
| couponapi       | 语法     | hotelTargetMoneyAPI(data)                                  |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入优惠显示界面           |
|                 | 后置条件 | 增添新的满减优惠                                           |
|                 | 语法     | hotelTargetRoomAPI(data)                                   |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入优惠显示界面           |
|                 | 后置条件 | 增添新的多间优惠                                           |
|                 | 语法     | hotelTimeAPI(data)                                         |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入优惠显示界面           |
|                 | 后置条件 | 增添新的限时优惠                                           |
|                 | 语法     | hotelBirthdayAPI(data)                                     |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入优惠显示界面           |
|                 | 后置条件 | 增添新的生日优惠                                           |
|                 | 语法     | hotelAllCouponsAPI(hotelId)                                |
|                 | 前置条件 | 无                                                         |
|                 | 后置条件 | 显示优惠界面                                               |
|                 | 语法     | deleteCouponAPI(couponID)                                  |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入优惠显示界面           |
|                 | 后置条件 | 删除指定id的优惠券                                         |
|                 | 语法     | orderMatchCouponsAPI()                                     |
|                 | 前置条件 | 以客户身份完成登录并填写一份订单并选择一种优惠             |
|                 | 后置条件 | 输出该订单是否满足该优惠的条件                             |
| hotelapi        | 语法     | getHotelsAPI()                                             |
|                 | 前置条件 | 以客户身份完成登录                                         |
|                 | 后置条件 | 显示所有酒店列表界面                                       |
|                 | 语法     | getHotelByIdAPI(param)                                     |
|                 | 前置条件 | 以客户身份完成登录                                         |
|                 | 后置条件 | 显示对应酒店详细界面                                       |
|                 | 语法     | deleteHotelAPI(hotelId)                                    |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入酒店管理界面           |
|                 | 后置条件 | 删除选定的酒店                                             |
|                 | 语法     | updateHotelAPI(data)                                       |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入酒店管理界面           |
|                 | 后置条件 | 更新选定酒店信息                                           |
| hotelmanagerapi | 语法     | addRoomAPI(data)                                           |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入添加酒店房间界面       |
|                 | 后置条件 | 添加房间类型                                               |
|                 | 语法     | addHotelAPI(data)                                          |
|                 | 前置条件 | 以酒店工作人员的身份完成登录，并进入添加酒店界面           |
|                 | 后置条件 | 添加酒店                                                   |
| orderapi        | 语法     | reserveHotelAPI(data)                                      |
|                 | 前置条件 | 以客户身份完成登录                                         |
|                 | 后置条件 | 添加一份订单                                               |
|                 | 语法     | getAllOrdersAPI()                                          |
|                 | 前置条件 | 以网站管理人员的身份完成登录                               |
|                 | 后置条件 | 显示所有订单                                               |
|                 | 语法     | getUserOrdersAPI(data)                                     |
|                 | 前置条件 | 以网站管理人员的身份完成登录/以客户的身份完成登录          |
|                 | 后置条件 | 显示该客户所有订单                                         |
|                 | 语法     | cancelOrderAPI(orderId)                                    |
|                 | 前置条件 | 以客户身份完成登录进入订单页面                             |
|                 | 后置条件 | 将对应订单状态显示为已撤销                                 |
|                 | 语法     | scoreOrderAPI(params)                                      |
|                 | 前置条件 | 以客户身份完成登录，并且有已执行的订单                     |
|                 | 后置条件 | 对对应的订单所属酒店进行评分                               |
|                 | 语法     | doOrderAPI(orderId)                                        |
|                 | 前置条件 | 以酒店管理员身份完成登录，且有客户预定后正常入住、退房     |
|                 | 后置条件 | 更新对应用户的订单状态为“已执行”                           |
|                 | 语法     | deleteOrderAPI(orderId)                                    |
|                 | 前置条件 | 以酒店管理员身份完成登录，且有客户撤销订单                 |
|                 | 后置条件 | 删除对应已撤销订单                                         |
| userapi         | 语法     | loginAPI(data)                                             |
|                 | 前置条件 | 以某个身份完成注册                                         |
|                 | 后置条件 | 实现以某种用户身份完成登录                                 |
|                 | 语法     | registerAPI(data)                                          |
|                 | 前置条件 | 无                                                         |
|                 | 后置条件 | 以某个身份完成注册                                         |
|                 | 语法     | getUserInfoAPI(id)                                         |
|                 | 前置条件 | 以某种身份完成登录                                         |
|                 | 后置条件 | 显示对应的用户个人信息                                     |
|                 | 语法     | updateUserInfoAPI(data)                                    |
|                 | 前置条件 | 以某种身份完成登录                                         |
|                 | 后置条件 | 更新对应用户个人信息                                       |
|                 | 语法     | getCreditRecordAPI(data)                                   |
|                 | 前置条件 | 以某种身份完成登录                                         |
|                 | 后置条件 | 显示该用户的信用值更变记录                                 |
|                 | 语法     | registerVipAPI(data)                                       |
|                 | 前置条件 | 以某种身份完成登录                                         |
|                 | 后置条件 | 将该用户注册成vip                                          |

**需接口**

| 服务名                                                       | 服务                                 |
| ------------------------------------------------------------ | ------------------------------------ |
| AdminController.addManager(UserForm userForm)                | 增加新的酒店管理员                   |
| AdminController.updateManager(UserForm userForm,int id)      | 更新酒店管理员信息                   |
| AdminController.addUser(UserForm userForm)                   | 增加新的一般用户                     |
| AdminController.addCredit(int id,String credit)              | 改变对应id用户的信用值               |
| AdminController.getAllManagers()                             | 返回所有酒店工作人员列表             |
| AdminController.getAllUsers()                                | 返回所有一般用户列表                 |
| AdminController.deleteOrder(int userid)                      | 删除对应id的用户                     |
| AdminController.updateInfo(UserForm userForm,int id)         | 更新对应id的一般用户信息             |
| CouponController.addHotelTargetMoneyCoupon(HotelTargetMoneyCouponVO hotelTargetMoneyCouponVO) | 增加满减优惠券                       |
| CouponController.addHotelTimeCoupon(HotelTimeCouponVO hotelTimeCouponVO) | 增加限时优惠券                       |
| CouponController.addHotelBirthdayCoupon(HotelBirthdayCouponVO hotelBirthdayCouponVO) | 增加生日优惠券                       |
| CouponController.addHotelTargetRoomCoupon(HotelTargetRoomCouponVO hotelTargetRoomCouponVO) | 增加多间优惠券                       |
| CouponController.getHotelAllCoupons(Integer hotelId)         | 返回对应酒店所有优惠策略             |
| CouponController.getOrderMatchCoupons(Integer userId,Integer hotelId,Double orderPrice,Integer roomNum,String checkIn,String checkOut) | 传入对应订单信息，进一步调用匹配方法 |
| CouponController.deleteCoupon(int couponId)                  | 删除对应couponId的优惠策略           |
| HotelController.createHotel(HotelVO hotelVO)                 | 创建酒店                             |
| HotelController.retrieveAllHotels(String userId)             | 获取所有酒店信息                     |
| HotelController.addRoomInfo(HotelRoom hotelRoom)             | 在对应酒店新增房型                   |
| HotelController.updateHotel(Hotel hotel)                     | 更新对应酒店信息                     |
| HotelController.retrieveHotelDetail(Integer hotelId)         | 返回对应酒店的详细信息               |
| HotelController.deleteHotel(Integer hotelId)                 | 删除对应酒店                         |
| OrderController.reserveHotel(OrderVO orderVO)                | 在对应酒店预订订单                   |
| OrderController.retrieveAllOrders()                          | 返回所有的订单                       |
| OrderController.retrieveUserOrders(int userid)               | 返回对应用户的订单                   |
| OrderController.annulOrder(int orderid)                      | 撤销对应订单号的订单                 |
| OrderController.doOrder(int orderid)                         | 执行对应订单号的订单                 |
| OrderController.scoreOrder(int orderId,int value)            | 对已执行的订单进行评分               |
| OrderController.retrieveHotelOrders(Integer hotelId)         | 返回对应酒店的所有订单               |
| OrderController.deleteOrder(int orderid)                     | 删除对应订单号的订单                 |
| AccountController.login(UserForm userForm)                   | 返回登录信息                         |
| registerAccount(UserVO userVO）                              | 注册账号                             |
| getCreditRecord(int userId)                                  | 返回对应用户的信用值变更记录         |
| getUserInfo(int id)                                          | 返回对应用户的信息                   |
| updateInfo(UserInfoVO userInfoVO,int id)                     | 更新对应用户的信息                   |
| registerVip(VipInfoVO vipInfoVO,int id)                      | 对应用户申请成为vip                  |



### 5.3业务逻辑层分解

​	业务逻辑层包括多个针对界面的业务逻辑处理对象。设计图如下：

![image](https://wx2.sbimg.cn/2020/04/21/-1.png)

#### 5.3.1职责

|   模块   | 职责                                                     |
| :------: | :------------------------------------------------------- |
| adminbl  | 负责实现网站管理界面的实现                               |
| couponbl | 负责实现优惠卷管理，获取，设置页面的实现                 |
| hotelbl  | 负责实现酒店信息管理，获取与房间信息管理，获取页面的实现 |
| orderbl  | 负责实现订单查看，管理页面的实现                         |
|  userbl  | 负责实现用户登录界面与用户信息管理界面的实现             |



#### 5.3.2接口规范

##### 5.3.2.1adminbl模块的接口规范

**供接口**

| 接口名                      | 属性     | 内容                                                      |
| --------------------------- | -------- | --------------------------------------------------------- |
|                             | 语法     | public ResponseVO addManager(UserForm userForm)           |
| AdminService.addManager     | 前置条件 | 输入符合规范                                              |
|                             | 后置条件 | 数据库内容更新，增添新的manager                           |
|                             | 语法     | public List getAllManagers()                              |
| AdminService.getAllManagers | 前置条件 | 无                                                        |
|                             | 后置条件 | 返回所有manager数据                                       |
|                             | 语法     | public ResponseVO updateManager(UserForm userForm,int id) |
| AdminService.updateManager  | 前置条件 | 酒店管理人员id已存入数据库，更新信息符合规范              |
|                             | 后置条件 | 更新酒店管理员信息                                        |
|                             | 语法     | public ResponseVO addUser(UserForm userForm)              |
| AdminService.addUser        | 前置条件 | 输入信息符合规范                                          |
|                             | 后置条件 | 新增一般用户                                              |
|                             | 语法     | public ResponseVO updateCredit(int id,String credit)      |
| AdminService.updateCredit   | 前置条件 | 一般用户id已存入数据库，信用值记录符合规范                |
|                             | 后置条件 | 更新信用值变更记录                                        |
|                             | 语法     | public List<User> getAllUsers()                           |
| AdminService.getAllUsers    | 前置条件 | 无                                                        |
|                             | 后置条件 | 返回所有一般用户列表                                      |
|                             | 语法     | public ResponseVO deleteUser(int userid)                  |
| AdminService.deleteUser     | 前置条件 | 一般用户id已存入数据库                                    |
|                             | 后置条件 | 删除对应id用户                                            |
|                             | 语法     | public ResponseVO updateUser(int id,UserForm userForm)    |
| AdminService.updateUser     | 前置条件 | 一般用户id已存入数据库，更新信息符合规范                  |
|                             | 后置条件 | 更新一般用户信息                                          |

**需接口**

| 服务名                                                      | 服务                       |
| ----------------------------------------------------------- | -------------------------- |
| User.setEmail(String email)                                 | 设置用户邮箱               |
| User.setPassword(String password)                           | 设置用户密码               |
| User.setUserType(UserType userType)                         | 设置用户类型               |
| User.setUserName(String userName)                           | 设置用户名                 |
| User.setPhoneNumber(String phoneNumber)                     | 设置用户电话号码           |
| User.setBirthday(Date birthday)                             | 设置用户生日               |
| User.setCredit(double credit)                               | 设置用户信用值             |
| User.getEmail()                                             | 获取用户邮箱               |
| User.getPassword()                                          | 获取用户密码               |
| User.getUsername()                                          | 获取用户类型               |
| User.getPhonenumber()                                       | 获取用户名                 |
| User.getBirthday()                                          | 获取用户生日               |
| User.getCredit()                                            | 获取用户信用值             |
| UserForm.getEmail()                                         | 从vo对象中获取用户邮箱     |
| UserForm.getPassword()                                      | 从vo对象中获取用户密码     |
| UserForm.getUsername()                                      | 从vo对象中获取用户名       |
| UserForm.getPhonenumber()                                   | 从vo对象中获取用户电话号码 |
| UserForm.getBirthday()                                      | 从vo对象中获取用户生日     |
| UserForm.getCredit()                                        | 从vo对象中获取用户信用值   |
| CreditRecord.setRestValue(double restValue)                 | 设置剩余信用值             |
| CreditRecord.setChangeTime(Date changeTime)                 | 设置变更日期               |
| CreditRecord.setChangeValue(double changeValue)             | 设置变更信用值             |
| CreditRecord.setReason(String reason)                       | 设置变更原因               |
| CreditRecord.setUserId(int userId)                          | 设置变更用户ID             |
| AccountService.getUserInfo(id)                              | 通过用户id获取用户信息     |
| AdminMapper.getAllManagers()                                | 获取所有manager信息        |
| AdminMapper.addManager(User user)                           | 增加新的酒店管理员         |
| AdminMapper.updateManager(User user)                        | 更新酒店管理员信息         |
| AdminMapper.addUser(User user)                              | 增加新的一般用户           |
| AdminMapper.deleteUser(int userid)                          | 删除对应id用户             |
| AdminMapper.updateCredit(int id,double credit)              | 更新对应id用户的信用值     |
| AdminMapper.updateUser(User user)                           | 更新一般用户信息           |
| AdminMapper.getAllUsers()                                   | 获取所有一般用户信息       |
| AccountMapper.insertCreditRecord(CreditRecord creditRecord) | 往账户中插入信用值变更记录 |
| ResponseVO.buildSuccess()                                   | 反馈构建成功               |
| ResponseVO.buildFailure(String message)                     | 反馈构建失败               |



##### 5.3.2.2couponbl模块的接口规范

**供接口**

| 接口名                                  | 属性     | 内容                                                         |
| --------------------------------------- | -------- | ------------------------------------------------------------ |
|                                         | 语法     | public boolean isMatch(OrderVO orderVO, Coupon coupon)       |
| CouponMatchStrategy.isMatch             | 前置条件 | orderVO和coupon对象均不为Null                                |
|                                         | 后置条件 | 得到一个布尔值作为结果，表示优惠券是否在这个订单上可用。     |
|                                         | 语法     | public List<Coupon> getMatchOrderCoupon(OrderVO orderVO)     |
| CouponService.getMatchOrderCoupon       | 前置条件 | orderVO对象不为空，orderVO.hotelId在数据库中存在             |
|                                         | 后置条件 | 查找到所有适用的优惠券，并得到一个列表。                     |
|                                         | 语法     | public List<Coupon> getHotelAllCoupon(Integer hotelId)       |
| CouponService.getHotelAllCoupon         | 前置条件 | hotelId必须是数据库中已经存在的合法值。                      |
|                                         | 后置条件 | 查找到所有对应酒店的优惠券，得到一个列表。                   |
|                                         | 语法     | public CouponVO addHotelTargetMoneyCoupon(HotelTargetMoneyCouponVO couponVO) |
| CouponService.addHotelTargetMoneyCoupon | 前置条件 | 输入的couponVO对象的成员变量符合要求。                       |
|                                         | 后置条件 | 在数据库中插入了一个新的满减优惠券，并得到它在数据库中的ID。 |
|                                         | 语法     | public CouponVO addHotelTimeCoupon(HotelTimeCouponVO couponVO) |
| CouponService.addHotelTimeCoupon        | 前置条件 | 输入的couponVO对象的成员变量符合要求。                       |
|                                         | 后置条件 | 在数据库中插入了一个新的限时优惠券，并得到它在数据库中的ID。 |
|                                         | 语法     | public CouponVO addHotelTargetRoomCoupon(HotelTargetRoomCouponVO couponVO) |
| CouponService.addHotelTargetRoomCoupon  | 前置条件 | 输入的couponVO对象的成员变量符合要求。                       |
|                                         | 后置条件 | 在数据库中插入了一个新的多间优惠券，并得到它在数据库中的ID。 |
|                                         | 语法     | public CouponVO addHotelBirthdayCoupon(HotelBirthdayCouponVO couponVO) |
| CouponService.addHotelBirthdayCoupon    | 前置条件 | 输入的couponVO对象的成员变量符合要求。                       |
|                                         | 后置条件 | 在数据库中插入了一个新的生日优惠券，并得到它在数据库中的ID。 |
|                                         | 语法     | public ResponseVO deleteCoupon(int couponId)                 |
| CouponService.deleteCoupon              | 前置条件 | 输入的couponid在数据库中存在记录                             |
|                                         | 后置条件 | 删除对应id的优惠券                                           |

**需接口**

| 服务名                                        | 服务                                             |
| --------------------------------------------- | ------------------------------------------------ |
| CouponMapper.selectByHotelId(int id)          | 从数据库中查询并获取对应酒店的所有优惠策略列表。 |
| CouponMapper.insertCoupon(coupon c)           | 向数据库中插入单一持久化优惠策略对象。           |
| CouponMapper.deleteCoupon( int couponId)      | 删除对应ID的优惠券                               |
| AccountService.getUserInfo(int id)            | 通过id获取用户信息                               |
| User.getBirthday()                            | 获取用户生日                                     |
| CouponVO.getDescription()                     | 获取优惠券描述                                   |
| CouponVO.getName()                            | 获取优惠券名字                                   |
| CouponVO.getType()                            | 获取优惠券类型                                   |
| CouponVO.getHotelId()                         | 获取适用酒店ID                                   |
| CouponVO.getDiscountMoney()                   | 获取折扣金额                                     |
| HotelTargetMoneyCouponVO.getTargetMoney()     | 获取满减目标金额                                 |
| HotelTargetRoomCouponVO.getTargetRoom()       | 获取多间目标间数                                 |
| HotelTimeCouponVO.getStartTime()              | 获取限时开始时间                                 |
| HotelTimeCouponVO.getEndTime()                | 获取限时结束时间                                 |
| OrderVO.getCheckInDate()                      | 获取订单入住日期                                 |
| OrderVO.getCheckOutDate()                     | 获取订单退房日期                                 |
| OrderVO.getRoomNum()                          | 获取订单房间数                                   |
| OrderVO.getPrice()                            | 获取订单总价（折后）                             |
| Coupon.setStartTime(Date startTime)           | 设置限时开始时间                                 |
| Coupon.setEndTime(Date endTime)               | 设置限时结束时间                                 |
| Coupon.setDescription(String description)     | 设置优惠券描述                                   |
| Coupon.setCouponName(String couponName)       | 设置优惠券名字                                   |
| Coupon.setTargetMoney(double targetMoney)     | 设置满减目标金额                                 |
| Coupon.setTargetRoom(double targetRoom)       | 设置多间目标间数                                 |
| Coupon.setDiscountMoney(double discountMoney) | 设置折扣金额                                     |
| Coupon.setHotelId(Integer hotelId)            | 设置适用酒店id                                   |
| Coupon.setCouponType(Integer couponType)      | 设置优惠券类型                                   |
| Coupon.setStatus(Integer status)              | 设置优惠券状态                                   |
| Coupon.getTargetMoney()                       | 获取满减目标金额                                 |
| Coupon.getTargetRoom()                        | 获取多间目标间数                                 |
| Coupon.getStartTime()                         | 获取限时开始时间                                 |
| Coupon.getEndTime()                           | 获取限时结束时间                                 |
| Coupon.getCouponType()                        | 获取优惠券类型                                   |
| ResponseVO.buildSuccess(true)                 | 返回成功信息                                     |
| ResponseVO.buildFailure（String massage）     | 返回失败信息                                     |

##### 5.3.2.3hotelbl模块的接口规范

**供接口**

| 接口名                             | 属性     | 内容                                                         |
| ---------------------------------- | -------- | ------------------------------------------------------------ |
|                                    | 语法     | public void addHotel(HotelVO hotelVO)                        |
| HotelService.addHotel              | 前置条件 | 要插入酒店的管理员不能为空，而且当前操作用户必须为网站管理人。 |
|                                    | 后置条件 | 在数据库中插入单一持久化酒店对象。                           |
|                                    | 语法     | public void updateRoomInfo(Integer hotelId, String roomType,Integer rooms) |
| HotelService.updateRoomInfo        | 前置条件 | hotelId是数据库中存在的合理值，roomType是枚举的一种，rooms为合理整数。 |
|                                    | 后置条件 | 在数据库中更新对应酒店的这种房间的数量信息。                 |
|                                    | 语法     | public int getRoomCurNum(Integer hotelId, String roomType)   |
| HotelService.getRoomCurNum         | 前置条件 | hotelId必须是数据库中已经存在的合法值，roomType是枚举的一种。 |
|                                    | 后置条件 | 查找到对应酒店的对应房间类型房间的数量。                     |
|                                    | 语法     | public List<HotelVO> retrieveHotels()                        |
| HotelService.retrieveHotels        | 前置条件 | 数据库已启动并且可正常访问。                                 |
|                                    | 后置条件 | 查询得到所有酒店列表。                                       |
|                                    | 语法     | public HotelVO retrieveHotelDetails(Integer hotelId)         |
| HotelService.retrieveHotelDetails  | 前置条件 | hotelId是数据库中已经存在的合法值。                          |
|                                    | 后置条件 | 查询得到对应酒店的数据对象。                                 |
|                                    | 语法     | public ResponseVO deleteHotel(int hotelId)                   |
| HotelService.deleteHotel           | 前置条件 | 输入的hotelID已存在于数据库中                                |
|                                    | 后置条件 | 删除对应hotelID的酒店                                        |
|                                    | 语法     | public void updateHotelInfo(Hotel hotel)                     |
| HotelService.updateHotelInfo       | 条件     | 输入的hotel信息符合规范                                      |
|                                    | 后置条件 | 更新对应的hotel信息                                          |
|                                    | 语法     | public List<Order> getHotelOrders(Integer hotelId)           |
| HotelService.getHotelOrders        | 前置条件 | hotelId是数据库中已经存在的合法值。                          |
|                                    | 后置条件 | 查询得到对应酒店的所有订单数据对象列表                       |
|                                    | 语法     | public List<HotelRoom> retrieveHotelRoomInfo(Integer hotelId) |
| HotelService.retrieveHotelRoomInfo | 前置条件 | hotelId是数据库中已经存在的合法值。                          |
|                                    | 后置条件 | 查找得到对应酒店的房间数据对象列表。                         |
|                                    | 语法     | public void insertRoomInfo(HotelRoom hotelRoom)              |
| HotelService.insertRoomInfo        | 前置条件 | hotelRoom的roomType为合法枚举值，hotelId为已存在的合法值，price和总数total合理 |
|                                    | 后置条件 | 在数据库中插入单一持久房间对象                               |
|                                    | 语法     | public void updateRoomInfo(Integer hotelId, String roomType, Integer rooms) |
| HotelService.updateRoomInfo        | 前置条件 | hotelId是数据库中存在的合理值，roomType是枚举的一种，rooms为合理整数。 |
|                                    | 后置条件 | 在数据库中更新对应酒店的这种房间的数量信息。                 |
|                                    | 语法     | public int getRoomCurNum(Integer hotelId, String roomType)   |
| HotelService.getRoomCurNum         | 前置条件 | hotelId必须是数据库中已经存在的合法值，roomType是枚举的一种。 |
|                                    | 后置条件 | 查找到对应酒店的对应房间类型房间的数量。                     |

**需接口**

| 服务名                                                       | 服务                                       |
| ------------------------------------------------------------ | ------------------------------------------ |
| AccountService.getUserInfo(int id)                           | 获得酒店的管理员单一持久化对象             |
| OrderService.getAllOrders()                                  | 获得所有订单数据对象列表                   |
| OrderService.getUserOrders(int userId)                       | 获得对应用户的所有订单                     |
| HotelMapper.updateRoomInfo(Integer hotelId, String roomType, Integer rooms) | 更新对应酒店的对应房型的房间数             |
| HotelMapper.insertHotel(Hotel h)                             | 向数据库中插入酒店单一持久化对象           |
| HotelMapper.selectAllHotel()                                 | 获得所有酒店数据对象列表                   |
| HotelMapper.selectById(int id)                               | 按照id查询获得酒店数据对象                 |
| HotelMapper.deleteHotel(int id)                              | 删除对应hotelID的酒店                      |
| HotelMapper.updateHotel(Hotel hotel)                         | 更新对应酒店的信息                         |
| RoomMapper.selectRoomsByHotelId(int id)                      | 根据酒店ID查询获得所有房间数据对象列表     |
| RoomMapper.insertRoom(HotelRoom r)                           | 向数据库中插入房间单一持久化对象           |
| RoomMapper.updateRoomInfo(int id,roomType t,int n)           | 更新数据库对应酒店的对应房间类型的房间数量 |
| RoomMapper.getRoomCurNum(int id,roomType t)                  | 查询数据库获得对应酒店的对应类型房间的数量 |
| RoomMapper.addRoomTotalNum(Integer hotelId,String RoomType,Integer newroom) | 增加对应酒店对应房型的房间数量             |



##### 5.3.2.4orderbl模块的接口规范

**供接口**

| 接口名                      | 属性     | 内容                                                         |
| --------------------------- | -------- | ------------------------------------------------------------ |
|                             | 语法     | public ResponseVO addOrder(OrderVO orderVO)                  |
| OrderService.addOrder       | 前置条件 | 订单对象不为Null                                             |
|                             | 后置条件 | 在数据库中插入单一持久化订单对象。                           |
|                             | 语法     | public List<Order> getAllOrders();                           |
| OrderService.getAllOrders   | 前置条件 | 数据库已启动并且可正常访问。                                 |
|                             | 后置条件 | 查询得到所有订单列表。                                       |
|                             | 语法     | public List<Order> getUserOrders(int userid);                |
| OrderService.getUserOrders  | 前置条件 | userid必须是数据库中已经存在的合法值。                       |
|                             | 后置条件 | 查找得到对应用户的订单数据对象列表。                         |
|                             | 语法     | public CouponVO addHotelTargetMoneyCoupon(HotelTargetMoneyCouponVO couponVO) |
| OrderService.annulOrder     | 前置条件 | orderid必须是数据库中已经存在的合法值，而且订单状态不能为已撤销。 |
|                             | 后置条件 | 在数据库中更新对应订单对象的状态为已撤销。                   |
|                             | 语法     | public List<Order> getHotelOrders(Integer hotelId)           |
| OrderService.getHotelOrders | 前置条件 | 输入的酒店ID合法                                             |
|                             | 后置条件 | 返回在该酒店的所有订单                                       |
|                             | 语法     | public ResponseVO doOrder(int orderid)                       |
| OrderService.doOrder        | 前置条件 | 输入的订单ID合法                                             |
|                             | 后置条件 | 将订单的执行状态改为“已执行”                                 |
|                             | 语法     | public ResponseVO deleteOrder(int id)                        |
| OrderService.deleteOrder    | 前置条件 | 输入的订单ID合法                                             |
|                             | 后置条件 | 删除对应订单ID的订单                                         |
|                             | 语法     | public ResponseVO scoreOrder(int value, int orderId)         |
| OrderService.scoreOrder     | 前置条件 | 输入的评分值与订单ID合法                                     |
|                             | 后置条件 | 为酒店评分                                                   |

**需接口**

| 服务名                                                      | 服务                                   |
| ----------------------------------------------------------- | -------------------------------------- |
| AccountService.getUserInfo(int uid)                         | 获得id对应的用户数据对象               |
| HotelService.getRoomCurNum(int hid,roomType t)              | 获得对应酒店对应房间的数量             |
| HotelService.updateRoomInfo(int hid,roomTpye t,int n)       | 更新数据库中对应酒店对应房间的数量     |
| OrderVO.setCreateDate(String createDate)                    | 设置订单创建日期                       |
| OrderVO.setOrderState(String orderState)                    | 设置订单状态                           |
| OrderVO.setClientName(String clientName)                    | 设置用户名字                           |
| OrderVO.setPhoneNumber(String phoneNumber)                  | 设置电话号码                           |
| HotelVO.getRate()                                           | 获取酒店评分                           |
| HotelVO.getScoreNum()                                       | 获取酒店评分数                         |
| User.getId()                                                | 获取用户ID                             |
| CreditRecord.setRestValue(double restValue)                 | 设置剩余信用值                         |
| CreditRecord.setChangeTime(Date changeTime)                 | 设置变更时间                           |
| CreditRecord.setChangeValue(double changeValue)             | 设置变更值                             |
| CreditRecord.setReason(String reason)                       | 设置变更原因                           |
| CreditRecord.setUserId(int userId)                          | 设置用户ID                             |
| ResponseVO.buildSuccess(boolean t)                          | 发回正确信息的回复数据对象             |
| ResponseVO.buildFailure(String s)                           | 发回错误信息的回复数据对象             |
| OrderMapper.getAllOrders()                                  | 查询获得所有订单的数据对象列表         |
| OrderMapper.getUserOrders(int uid)                          | 查询获得对应id的用户的订单数据对象列表 |
| OrderMapper.getOrderById(int oid)                           | 查询获得对应id的订单数据对象           |
| OrderMapper.annulOrder(int oid)                             | 将数据库中对应订单的状态设置为“已撤销” |
| OrderMapper.doOrder(int oid)                                | 将数据库中对应订单的状态设置为“已执行” |
| OrderMapper.addOrder(Order o)                               | 向数据库中插入订单单一持久化对象       |
| OrderMapper.deleteOrder(int oid)                            | 删除数据库中对应订单号的订单           |
| OrderMapper.updateScore(int orderId)                        | 更新对应订单ID的订单                   |
| HotelMapper.updateScore(double value,int hotelId)           | 更新对应酒店ID的评分                   |
| HotelMapper.selectById(int id)                              | 按照id查询获得酒店数据对象             |
| AccountMapper.getAccountById(userId)                        | 通过用户ID获取用户信息                 |
| AccountMapper.updateCredit(int id,double credit)            | 更新对应ID用户的信用值                 |
| AccountMapper.insertCreditRecord(CreditRecord creditRecord) | 往账户中插入信用值变更记录             |



##### 5.3.2.5userbl模块的接口规范

**供接口**

| 接口名                         | 属性     | 内容                                                         |
| ------------------------------ | -------- | ------------------------------------------------------------ |
|                                | 语法     | ResponseVO registerAccount(UserVO userVO)                    |
| AccountService.registerAccount | 前置条件 | 输入符合规范                                                 |
|                                | 后置条件 | 查找是否存在当前用户，返回注册结果                           |
|                                | 语法     | User login(UserForm userForm)                                |
| AccountService.login           | 前置条件 | 输入符合规范                                                 |
|                                | 后置条件 | 查找是否存在当前用户，验证密码是否正确，返回验证结果         |
|                                | 语法     | public List<CreditRecord> getCreditRecord(int userId)        |
| AccountService.getCreditRecord | 前置条件 | userID在数据库中存在                                         |
|                                | 后置条件 | 返回对应用户的信用值记录                                     |
|                                | 语法     | public User getUserInfo(int id)                              |
| AccountService.getUserInfo     | 前置条件 | id输入符合规范                                               |
|                                | 后置条件 | 查找是否存在当前用户，返回结果                               |
|                                | 语法     | public ResponseVO updateUserInfo(int id, String password, String username, String phonenumber) |
| AccountService.updateUserInfo  | 前置条件 | 输入符合规范                                                 |
|                                | 后置条件 | 更新数据库数据                                               |
|                                | 语法     | public ResponseVO registerVip(int id, String vipType, String vipInfo) |
| AccountService.registerVip     | 前置条件 | 输入符合规范且userid存在于数据库                             |
|                                | 后置条件 | 为对应userID的用户注册VIP                                    |

**需接口**

| 服务名                                                       | 服务                     |
| ------------------------------------------------------------ | ------------------------ |
| AccountMapper.createNewAccount(User user)                    | 根据信息创建新的用户     |
| AccountMapper.getAccountByName(String email)                 | 根用户名返回账号         |
| AccountMapper.getCreditRecord(int userId)                    | 根据用户ID返回信用值记录 |
| AccountMapper.getAccountById(int id)                         | 根据id获取用户           |
| AccountMapper.int updateAccount(int id,String password,String username,String phonenumber，String birthday) | 更新用户数据             |
| AccountMapper.registerVip(int id, String vipType, String vipInfo) | 为对应id的用户申请VIP    |



### 5.4数据层分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。

![](https://web-1302222241.cos.ap-nanjing.myqcloud.com/%E6%95%B0%E6%8D%AE%E5%B1%82%E7%B1%BB%E5%9B%BE%20%281%29.png)

#### 5.4.1职责

|     模块      | 职责                                                         |
| :-----------: | :----------------------------------------------------------- |
|  adminmapper  | 持久化数据库的接口，提供增加管理员、查找管理员服务           |
| couponmapper  | 持久化数据库的接口，提供增加优惠、查找优惠服务               |
|  hotelmapper  | 持久化数据库的接口，提供增加酒店、查找优惠酒店服务           |
|  roommapper   | 持久化数据库的接口，提供增加酒店房间、查找酒店房间、更新酒店房间服务 |
|  ordermapper  | 持久化数据库的接口，提供增加酒店订单、查找酒店订单、删除酒店房间服务 |
| accountmapper | 持久化数据库的接口，提供增加账号、查找账号、更新账号服务     |

#### 5.4.2接口规范

##### 5.4.2.1AdminMapper模块接口规范

**供接口**

| 接口名                                         | 属性     | 内容                                           |
| ---------------------------------------------- | -------- | ---------------------------------------------- |
|                                                | 语法     | int addManager(User user)                      |
| AdminMapper.addManager                         | 前置条件 | 传入的User对象符合规范                         |
|                                                | 后置条件 | 添加酒店管理人员账号                           |
|                                                | 语法     | List<User> getAllManagers()                    |
| AdminMapper.getAllManagers                     | 前置条件 | 数据库中已经有酒店管理员                       |
|                                                | 后置条件 | 查找到所有酒店管理员                           |
|                                                | 语法     | int updateManager(User user)                   |
| AdminMapper.updateManager(User user)           | 前置条件 | 输入信息符合规范                               |
|                                                | 后置条件 | 更新数据库中的酒店管理员信息                   |
|                                                | 语法     | int addUser(User user)                         |
| AdminMapper.addUser(User user)                 | 前置条件 | 输入信息符合规范                               |
|                                                | 后置条件 | 在数据库中新增一般用户                         |
|                                                | 语法     | int deleteUser(int userid)                     |
| AdminMapper.deleteUser(int userid)             | 前置条件 | 输入userID在数据库中存在                       |
|                                                | 后置条件 | 删除数据库中对应用户                           |
|                                                | 语法     | int updateCredit(int id,double credit)         |
| AdminMapper.updateCredit(int id,double credit) | 前置条件 | 输入userID在数据库中存在，输入的信用值符合规范 |
|                                                | 后置条件 | 更新对应userID的信用值                         |
|                                                | 语法     | int updateUser(User user)                      |
| AdminMapper.updateUser(User user)              | 前置条件 | 输入信息符合规范                               |
|                                                | 后置条件 | 更新对应一般用户的信息                         |
|                                                | 语法     | List<User> getAllUsers()                       |
| AdminMapper.getAllUsers()                      | 前置条件 | 数据库中已经有一般用户                         |
|                                                | 后置条件 | 查找到所有一般用户                             |



##### 5.4.2.2CouponMapper模块接口规范

**供接口**

| 接口名                       | 属性     | 内容                                           |
| ---------------------------- | -------- | ---------------------------------------------- |
|                              | 语法     | int insertCoupon(Coupon coupon)                |
| CouponMapper.insertCoupon    | 前置条件 | 传入的Coupon对象符合规范                       |
|                              | 后置条件 | 添加优惠策略                                   |
|                              | 语法     | List<Coupon> selectByHotelId(Integer hotelId); |
| CouponMapper.selectByHotelId | 前置条件 | 有至少一个酒店                                 |
|                              | 后置条件 | 得到相应Id的酒店的优惠策略列表                 |
|                              | 语法     | int deleteCoupon(int couponId)                 |
| CouponMapper.deleteCoupon    | 前置条件 | 传入的couponID存在于数据库中                   |
|                              | 后置条件 | 删除对应的优惠券                               |



##### 5.4.2.3HotelMapper模块接口规范

**供接口**

| 接口名                     | 属性     | 内容                                          |
| -------------------------- | -------- | --------------------------------------------- |
|                            | 语法     | int insertHotel(Hotel hotel)                  |
| HotelMapper.insertHotel    | 前置条件 | 同样ID的酒店po在数据库中不存在                |
|                            | 后置条件 | 在数据库增加一个酒店po记录                    |
|                            | 语法     | List selectAllHotel()                         |
| HotelMapper.selectAllHotel | 前置条件 | 无                                            |
|                            | 后置条件 | 查询得到所有酒店列表                          |
|                            | 语法     | public List<Order> getUserOrders(int userid)  |
| HotelMapper.selectById     | 前置条件 | 无                                            |
|                            | 后置条件 | 按ID进行查找返回相应的酒店po对象结果          |
|                            | 语法     | int deleteHotel(int hotelId)                  |
| HotelMapper.deleteHotel    | 前置条件 | 输入hotelID在数据库中存在                     |
|                            | 后置条件 | 删除数据库中的酒店                            |
|                            | 语法     | int updateHotel(Hotel hotel)                  |
| HotelMapper.updateHotel    | 前置条件 | 输入的酒店信息符合输入规范                    |
|                            | 后置条件 | 更新数据库中的酒店信息                        |
|                            | 语法     | int updateScore(double value,int hotelId)     |
| HotelMapper.updateScore    | 前置条件 | 输入hotelID在数据库中存在，输入的评分符合规范 |
|                            | 后置条件 | 更新对应酒店ID的评分                          |





##### 5.4.2.4RoomMapper模块接口规范

**供接口**

| 接口名                          | 属性     | 内容                                                         |
| ------------------------------- | -------- | ------------------------------------------------------------ |
|                                 | 语法     | int insertRoom(HotelRoom hotelRoom)                          |
| RoomMapper.insertRoom           | 前置条件 | 同样ID的房间po在数据库中不存在                               |
|                                 | 后置条件 | 在数据库增加一个房间po记录                                   |
|                                 | 语法     | int getRoomCurNum(Integer hotelId,String roomType);          |
| RoomMapper.getRoomCurNum        | 前置条件 | 在数据库中同样ID的酒店po存在，房间类型为合理枚举值           |
|                                 | 后置条件 | 查询得到对应酒店对应房间的数量                               |
|                                 | 语法     | List selectRoomsByHotelId(Integer hotelId)                   |
| RoomMapper.selectRoomsByHotelId | 前置条件 | 无                                                           |
|                                 | 后置条件 | 按酒店ID进行查找返回相应的酒店房间po对象结果列表             |
|                                 | 语法     | int updateRoomInfo(Integer hotelId,String roomType,Integer curNum) |
| RoomMapper.updateRoomInfo       | 前置条件 | 在数据库中同样ID的酒店po存在，房间类型为合理枚举值           |
|                                 | 后置条件 | 更新对应id酒店的对应类型的房间数量                           |
|                                 | 语法     | void addRoomTotalNum(Integer hotelId, String roomType,Integer newroom) |
| RoomMapper.addRoomTotalNum      | 前置条件 | 输入的hotelID、roomType、newroom符合规范                     |
|                                 | 后置条件 | 更新对应酒店对应房型的房间数                                 |

​                                                                          

##### 5.4.2.5OrderMapper接口规范

**供接口**

| 接口名                    | 属性     | 内容                            |
| ------------------------- | -------- | ------------------------------- |
|                           | 语法     | int addOrder(Order order)       |
| OrderMapper.addOrder      | 前置条件 | 输入符合规范                    |
|                           | 后置条件 | 数据库内容更新，增添新的Order   |
|                           | 语法     | List getAllOrders()             |
| OrderMapper.getAllOrders  | 前置条件 | 无                              |
|                           | 后置条件 | 返回所有Order数据               |
|                           | 语法     | List getUserOrders(int userid)  |
| OrderMapper.getUserOrders | 前置条件 | id输入规范，且id存在            |
|                           | 后置条件 | 返回对应id的用户的订单          |
|                           | 语法     | int annulOrder(int orderid)     |
| OderMapper.annulOrder     | 前置条件 | orderid输入规范，且id存在       |
|                           | 后置条件 | 撤销对应订单                    |
|                           | 语法     | Order getOrderById(int orderid) |
| OrderMapper.getOrderById  | 前置条件 | id输入规范，且id存在            |
|                           | 后置条件 | 返回对应的订单                  |
|                           | 语法     | int doOrder(int orderid)        |
| OrderMapper.doOrder       | 前置条件 | 输入的订单号存在数据库中        |
|                           | 后置条件 | 将订单状态改为“已执行”          |
|                           | 语法     | int deleteOrder(int orderid)    |
| OrderMapper.deleteOrder   | 前置条件 | 输入的订单号存在数据库中        |
|                           | 后置条件 | 删除对应订单号的订单            |
|                           | 语法     | int updateScore(int orderId)    |
| OrderMapper.updateScore   | 前置条件 | 输入的订单号存在数据库中        |
|                           | 后置条件 | 更新对应订单号订单的评分        |



##### 5.4.2.6AccountMapper接口规范

**供接口**

| 接口名                         | 属性     | 内容                                                         |
| ------------------------------ | -------- | ------------------------------------------------------------ |
|                                | 语法     | User getAccountById(int id)                                  |
| AccountMapper.getAccountById   | 前置条件 | id输入符合规范,且id存在                                      |
|                                | 后置条件 | 返回相应的账户                                               |
|                                | 语法     | int createNewAccount(User user)                              |
| AccountMapper.createNewAccount | 前置条件 | 输入符合规范                                                 |
|                                | 后置条件 | 数据库中创建一个新的账户                                     |
|                                | 语法     | User getAccountByName(String email)                          |
| AccountMapper.getAccountByName | 前置条件 | 输入规范                                                     |
|                                | 后置条件 | 返回相应账户                                                 |
|                                | 语法     | int updateAccount(int id, String password,String username,  String phonenumber) |
| AccountMapper.updateAccount    | 前置条件 | 所有输入符合规范                                             |
|                                | 后置条件 | 更新账户信息                                                 |
|                                | 语法     | int registerVip(int id, String vipType, String vipInfo)      |
| registerVip                    | 前置条件 | 输入的ID、vipType、vipInfo符合规范                           |
|                                | 后置条件 | 为对应ID的用户申请VIP                                        |
|                                | 语法     | int updateCredit(int id,double credit)                       |
| updateCredit                   | 前置条件 | 输入的ID、credit符合规范                                     |
|                                | 后置条件 | 更新对应ID的用户的信用值                                     |
|                                | 语法     | int insertCreditRecord(CreditRecord creditRecord)            |
| insertCreditRecord             | 前置条件 | 输入的CreditRecord符合规范                                   |
|                                | 后置条件 | 插入一条新的信用值变更记录                                   |
|                                | 语法     | List<CreditRecord> getCreditRecord(int userId)               |
| getCreditRecord                | 前置条件 | 输入的userId符合规范                                         |
|                                | 后置条件 | 返回该用户的全部信用值记录                                   |



### 6.信息视角

#### 6.1数据持久化对象(PO)

##### 6.1.1简单介绍

CouponPo：包含优惠券的id、描述、推出方、类型、名称、使用门槛、折扣、优惠金额、可用时间、失效时间、可用状态。

CreditRecord：包含信用值记录的id、用户id、信用变更值、剩余信用值、变更时间、变更原因。

HotelPo：包含酒店id、名称、地址、商圈、星级、评分、描述、电话、酒店管理员id。

HotelRoomPo：包含酒店房间id、房型、酒店id、价格、剩余可预订房间数、房间总数。

OrderPo：包含订单id、用户id、酒店id、酒店名称、入住时间、退房时间、房间类型、房间数量、人数、是否有孩子、订单创建日期、总价、客户名字、电话号码、订单状态。

UserPo：包含用户id、邮箱、名字、电话号码、信用值、用户类型。

##### 6.1.2定义

###### 6.1.2.1Coupon

```java
public class Coupon {
    /**
     * 优惠券id
     */
    private int id;
    /**
     * 优惠券描述
     */
    private String description;

    /**
     * 如果为-1 代表是网站推出的优惠
     */
    private Integer hotelId;

    /**
     * 优惠券类型 1生日特惠 2多间特惠 3满减优惠 4限时优惠
     */
    private Integer couponType;
    /**
     * 优惠券名称
     */
    private String couponName;
    /**
     * 优惠券使用门槛（总金额）
     */
    private double targetMoney;
    /**
     * 优惠券使用门槛（房间）
     */
    private double targetRoom;
    /**
     * 折扣
     */
    private double discount;
    /**
     * 优惠券优惠金额
     */
    private double discountMoney;
    /**
     * 可用时间
     */
    private Date startTime;
    /**
     * 失效时间
     */
    private Date endTime;

    /**
     * 优惠券状态 是否已经失效 1可用 0失效
     */
    private Integer status;

    public Date getStartTime() {
        return startTime;
    }

    public void setStartTime(Date startTime) {
        this.startTime = startTime;
    }

    public Date getEndTime() {
        return endTime;
    }

    public void setEndTime(Date endTime) {
        this.endTime = endTime;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public String getCouponName() {
        return couponName;
    }

    public void setCouponName(String couponName) {
        this.couponName = couponName;
    }

    public double getTargetMoney() {
        return targetMoney;
    }

    public void setTargetMoney(double targetMoney) {
        this.targetMoney = targetMoney;
    }

    public double getTargetRoom() {
        return targetRoom;
    }

    public void setTargetRoom(double targetRoom) {
        this.targetRoom = targetRoom;
    }

    public double getDiscountMoney() {
        return discountMoney;
    }

    public void setDiscountMoney(double discountMoney) {
        this.discountMoney = discountMoney;
    }

    public Integer getHotelId() {
        return hotelId;
    }

    public void setHotelId(Integer hotelId) {
        this.hotelId = hotelId;
    }

    public Integer getCouponType() {
        return couponType;
    }

    public void setCouponType(Integer couponType) {
        this.couponType = couponType;
    }

    public Integer getStatus() {
        return status;
    }

    public void setStatus(Integer status) {
        this.status = status;
    }

    public double getDiscount() {
        return discount;
    }

    public void setDiscount(double discount) {
        this.discount = discount;
    }

    public Coupon() {
    }
}
```



###### 6.1.2.2CreditRecord

```java
public class CreditRecord {
    private int id;
    private int userId;
    private double changeValue;
    private double restValue;
    private Date changeTime;
    private String reason;

    public void setRestValue(double restValue) {
        this.restValue = restValue;
    }

    public double getRestValue() {
        return restValue;
    }

    public Date getChangeTime() {
        return changeTime;
    }

    public double getChangeValue() {
        return changeValue;
    }

    public int getId() {
        return id;
    }

    public int getUserId() {
        return userId;
    }

    public String getReason() {
        return reason;
    }

    public void setChangeTime(Date changeTime) {
        this.changeTime = changeTime;
    }

    public void setChangeValue(double changeValue) {
        this.changeValue = changeValue;
    }

    public void setId(int id) {
        this.id = id;
    }

    public void setReason(String reason) {
        this.reason = reason;
    }

    public void setUserId(int userId) {
        this.userId = userId;
    }
}
```



###### 6.1.2.3Hotel

```java
public class Hotel {
    private Integer id;
    private String hotelName;
    private String address;
    /**
     * 商圈
     */
    private BizRegion bizRegion;
    private HotelStar hotelStar;
    private Double rate;
    private String description;
    private String phoneNum;
    /**
     * 酒店管理员id
     */
    private Integer managerId;
    private Integer scoreNum;

    public Integer getScoreNum() {
        return scoreNum;
    }

    public void setScoreNum(Integer scoreNum) {
        this.scoreNum = scoreNum;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getHotelName() {
        return hotelName;
    }

    public void setHotelName(String hotelName) {
        this.hotelName = hotelName;
    }

    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    public BizRegion getBizRegion() {
        return bizRegion;
    }

    public void setBizRegion(BizRegion bizRegion) {
        this.bizRegion = bizRegion;
    }

    public HotelStar getHotelStar() {
        return hotelStar;
    }

    public void setHotelStar(HotelStar hotelStar) {
        this.hotelStar = hotelStar;
    }

    public Double getRate() {
        return rate;
    }

    public void setRate(Double rate) {
        this.rate = rate;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public String getPhoneNum() {
        return phoneNum;
    }

    public void setPhoneNum(String phoneNum) {
        this.phoneNum = phoneNum;
    }

    public Integer getManagerId() {
        return managerId;
    }

    public void setManagerId(Integer managerId) {
        this.managerId = managerId;
    }
}
```



###### 6.1.2.4HotelRoom

```java
public class HotelRoom {
    private Integer id;
    private RoomType roomType;
    private Integer hotelId;
    private double price;
    /**
     * 当前剩余可预定房间数
     */
    private int curNum;
    /**
     * 某类型房间总数
     */
    private int total;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public RoomType getRoomType() {
        return roomType;
    }

    public void setRoomType(RoomType roomType) {
        this.roomType = roomType;
    }

    public Integer getHotelId() {
        return hotelId;
    }

    public void setHotelId(Integer hotelId) {
        this.hotelId = hotelId;
    }

    public double getPrice() {
        return price;
    }

    public void setPrice(double price) {
        this.price = price;
    }

    public int getCurNum() {
        return curNum;
    }

    public void setCurNum(int curNum) {
        this.curNum = curNum;
    }

    public int getTotal() {
        return total;
    }

    public void setTotal(int total) {
        this.total = total;
    }
}
```



###### 6.1.2.5Order

```java
public class Order {
    private Integer id;
    private Integer userId;
    private Integer hotelId;
    private String hotelName;
    private Date checkInDate;
    private Date checkOutDate;
    private String roomType;
    private Integer roomNum;
    private Integer peopleNum;
    private boolean haveChild;
    private String createDate;
    private Double price;
    private String clientName;
    private String phoneNumber;
    private String orderState;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }

    public Integer getHotelId() {
        return hotelId;
    }

    public void setHotelId(Integer hotelId) {
        this.hotelId = hotelId;
    }

    public Date getCheckInDate() {
        return checkInDate;
    }

    public void setCheckInDate(Date checkInDate) {
        this.checkInDate = checkInDate;
    }

    public Date getCheckOutDate() {
        return checkOutDate;
    }

    public void setCheckOutDate(Date checkOutDate) {
        this.checkOutDate = checkOutDate;
    }

    public String getRoomType() {
        return roomType;
    }

    public void setRoomType(String roomType) {
        this.roomType = roomType;
    }

    public Integer getRoomNum() {
        return roomNum;
    }

    public void setRoomNum(Integer roomNum) {
        this.roomNum = roomNum;
    }

    public Integer getPeopleNum() {
        return peopleNum;
    }

    public void setPeopleNum(Integer peopleNum) {
        this.peopleNum = peopleNum;
    }

    public boolean isHaveChild() {
        return haveChild;
    }

    public void setHaveChild(boolean haveChild) {
        this.haveChild = haveChild;
    }

    public String getCreateDate() {
        return createDate;
    }

    public void setCreateDate(String createDate) {
        this.createDate = createDate;
    }

    public Double getPrice() {
        return price;
    }

    public void setPrice(Double price) {
        this.price = price;
    }

    public String getHotelName() {
        return hotelName;
    }

    public void setHotelName(String hotelName) {
        this.hotelName = hotelName;
    }

    public String getClientName() {
        return clientName;
    }

    public void setClientName(String clientName) {
        this.clientName = clientName;
    }

    public String getPhoneNumber() {
        return phoneNumber;
    }

    public void setPhoneNumber(String phoneNumber) {
        this.phoneNumber = phoneNumber;
    }

    public String getOrderState() {
        return orderState;
    }

    public void setOrderState(String orderState) {
        this.orderState = orderState;
    }
}
```



###### 6.1.2.6User

```java
public class User {
    private Integer id;
    private String email;
    private String password;
    private String userName;
    private String phoneNumber;
    private Date birthday;
    private double credit;
    private UserType userType;
    private String vipType;
    private String vipInfo;


    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getPhoneNumber() {
        return phoneNumber;
    }

    public void setPhoneNumber(String phoneNumber) {
        this.phoneNumber = phoneNumber;
    }

    public double getCredit() {
        return credit;
    }

    public void setCredit(double credit) {
        this.credit = credit;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public UserType getUserType() {
        return userType;
    }

    public void setUserType(UserType userType) {
        this.userType = userType;
    }

    public Date getBirthday(){return this.birthday;}

    public void setBirthday(Date birthday){this.birthday=birthday;}

    public String getVipType() {
        return vipType;
    }

    public void setVipType(String vipType) {
        this.vipType = vipType;
    }

    public String getVipInfo() {
        return vipInfo;
    }

    public void setVipInfo(String vipInfo) {
        this.vipInfo = vipInfo;
    }
}
```



#### 6.2数据库表

##### 6.2.1简单介绍

数据库中包含Coupon表、Hotel表、Orderlist表、Room表、User表、Creditrecord表。

##### 6.2.2定义

###### 6.2.2.1Coupon

```sql
`id` int(11) NOT NULL AUTO_INCREMENT,
`description` varchar(255) DEFAULT NULL,
`hotelId` int(11) DEFAULT '-1',
`couponType` int(11) NOT NULL,
`couponName` varchar(255) NOT NULL,
`target_money` int(11) DEFAULT NULL,
`target_room` int(11) DEFAULT NULL,
`discount` double DEFAULT NULL,
`status` int(11) DEFAULT NULL,
`start_time` date DEFAULT NULL,
`end_time` date DEFAULT NULL,
`discount_money` int(11) DEFAULT NULL,
PRIMARY KEY (`id`)
```



###### 6.2.2.2Hotel

```sql
`id` int(11) NOT NULL AUTO_INCREMENT,
`hotelName` varchar(255) NOT NULL,
`hotelDescription` varchar(255) DEFAULT NULL,
`address` varchar(255) DEFAULT NULL,
`bizRegion` varchar(255) DEFAULT NULL,
`hotelStar` varchar(255) DEFAULT NULL,
`phoneNum` int(11) DEFAULT NULL,
`rate` double DEFAULT NULL,
`manager_id` int(11) DEFAULT NULL,
`scoreNum`int(11) DEFAULT 0,
PRIMARY KEY (`id`)
```



###### 6.2.2.3OrderList

```sql
`id` int(11) NOT NULL AUTO_INCREMENT,
`userId` int(11) DEFAULT NULL,
`hotelId` int(11) DEFAULT NULL,
`hotelName` varchar(255) DEFAULT NULL,
`checkInDate` date DEFAULT NULL,
`checkOutDate` date DEFAULT NULL,
`roomType` varchar(255) DEFAULT NULL,
`roomNum` int(255) DEFAULT NULL,
`peopleNum` int(255) DEFAULT NULL,
`haveChild` tinytext,
`createDate` varchar(255) DEFAULT NULL,
`price` decimal(65,0) DEFAULT NULL,
`clientName` varchar(255) DEFAULT NULL,
`phoneNumber` varchar(255) DEFAULT NULL,
`orderState` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`)
```



###### 6.2.2.4Room

```sql
`id` int(11) NOT NULL AUTO_INCREMENT,
`price` double DEFAULT NULL,
`curNum` int(11) DEFAULT NULL,
`total` int(11) DEFAULT NULL,
`hotel_id` int(11) DEFAULT NULL,
`roomType` varchar(50) DEFAULT NULL,
PRIMARY KEY (`id`)
```



###### 6.2.2.5User

```sql
`id` int(11) NOT NULL AUTO_INCREMENT,
`email` varchar(255) DEFAULT NULL,
`password` varchar(11) NOT NULL,
`username` varchar(255) DEFAULT NULL,
`phonenumber` varchar(255) DEFAULT NULL,
`birthday` date DEFAULT NULL,
`credit` double(255,0) DEFAULT NULL,
`usertype` varchar(255) DEFAULT NULL,
`vipType` varchar(255) DEFAULT NULL,
`vipInfo` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`)
```



###### 6.2.2.6CreditRecord

```sql
`id` int(11) NOT NULL AUTO_INCREMENT,
`userId` int(11) DEFAULT NULL,
`changeValue` DOUBLE(65,2) DEFAULT NULL,
`restValue` DOUBLE(65,2) DEFAULT NULL,
`changeTime` date DEFAULT NULL,
`reason` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`)
```

